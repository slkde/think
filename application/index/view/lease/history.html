<!DOCTYPE html>
<html>
<head>{include file="common@common/common"}</head>
<body>
{include file="common@common/head"}
<extend name="Base/yx-common"/>
<block name="body">
    <link href="__CSS__/common.css" type="text/css" rel="stylesheet">
    <link href="__CSS__/User_backpack.css" type="text/css" rel="stylesheet">
    <link href="__CSS__/goods_details.css" type="text/css" rel="stylesheet">
    <link href="__CSS__/lease.css" type="text/css" rel="stylesheet">
    <div class="cont-wrapper {$game_name}">
        <div class="lease-box clearfix bc">
            <!-- 详情页 公用头部--start-->
            {include file="index@lease/details-header"}
            <!-- 详情页 公用头部--end-->
            <div class="d-goods-other fl">
                <div class="d-goods-title">
                    <div class="menu-tab-btn">
                        <a class="backpack-menu-btn" href="/index.php/index/lease/details/info/{$info.goods_id}.html">出租商品</a>
                        <a class="backpack-menu-btn" href="/index.php/index/lease/echarts/info/{$info.goods_id}.html">价格走势</a>
                        <a class="backpack-menu-btn active" href="javascript:">出租历史</a>
                    </div>
                </div>
                <div class="good-other-onsell">
                    <span class="fl" style="width: 290px;">商品名称</span>
                    <span class="fl">买家</span>
                    <span class="fl">商品价格</span>
                    <span class="fl">成交时间</span>
                </div>
                <ul class="d-goods-other-list" style="display:block">
                    {volist name="data" id="vo"}
                        <li class="clearfix" data-id="{$vo.goods_id}" style="height:80px;">
                            <a class="fl g-other-img-wrap" target="_blank" style="background-image: url(__IMG__/goods-del-bg.png);">
                                <div class="g-other-img">
                                    <img src="{$info.goods_image_url}" alt="" class="goods-info-img">
                                </div>
                            </a>
                            <div class="fl g-other-faname">
                                <p class="over-hide" style="height:60px;line-height: 60px;">{$info.goods_name}</p>
                            </div>
                            <div class="fl g-other-fatime" style="margin-left: 0">
                                <time class="fl g-other-time">
                                    <span class="fl dashang-icon-wrap">
                                        <img class="user-head" style="width:45px;height: 45px;margin: 20px 0;" src="/{$vo.avatar}">
                                    </span>
                                    <a href="javascript:" class="fl over-hide" style="width: 70px;">{$vo.nickname}</a>
                                </time>
                            </div>
                            <div class="fl g-other-faprice">￥{$vo.lease_real_price}</div>
                            <div class="fl g-other-date">{$vo.lease_time|date="Y-m-d H:i:s",###}</div>
                        </li>
                    {/volist}
                </ul>
                <div class="virtual-more bc">
                    {$page}
                </div>
            </div>
            </div>
            <!-- 详情页 公用右侧推荐面板--start-->
            {include file="index@lease/right-panel"}
            <!-- 详情页 公用右侧推荐面板--end-->
    </div>
    </div>

    <script>
        $(function () {
            window.ImgequestRead = "https://steamcommunity-a.akamaihd.net/economy/image/";
            //商品图片滑过请求商品详情面板
            var goodsInfoPanel = true;
            var timer;
            $('.d-goods-other-list').on('mouseover', '.goods-info-img', function (e) {
                var _that = $(this);
                var goodsId = $(this).parents('li').attr('data-id');
                $(this).parents('li').siblings('li').find('.backpack-goods-modal').css('display', 'none');
                timer = setTimeout(function () {
                    if (_that.siblings('.backpack-goods-modal').css('display')) {
                        _that.siblings('.backpack-goods-modal').css('display', 'block');
                    } else {
                        if (goodsInfoPanel) {
                            goodsInfoPanel = false;
                            $.ajax({
                                type: 'get',
                                url: '/index.php/goods/content/getContent',
                                data: {'id': goodsId},
                                success: function (a) {
                                    if (a) {
                                        var d = JSON.parse(a);
                                        var goodsInfo = d.descriptions;
                                        var tags = d.tags;
                                        var html = '';
                                        var tagsHtml = '';
                                        if (goodsInfo) {
                                            for (var g = 0; g < goodsInfo.length; g++) {
                                                if (goodsInfo[g].value != ' ') {
                                                    html += '<div style="color:#' + goodsInfo[g].color + ';">' + goodsInfo[g].value + '</div>'
                                                }
                                            }
                                        }
                                        if (tags) {
                                            for (var s = 0; s < tags.length; s++) {
                                                tagsHtml += '<span style="color: #' + tags[s].color + ';">' + tags[s].localized_tag_name + '</span>'
                                            }
                                        }
                                        _that.parent().append('<div class="backpack-goods-modal" style="text-align: center;line-height: 16px;">' +
                                            '<img class="g-info-img" src="' + window.ImgequestRead + d.icon_url + '">' +
                                            '<div class="g-info-name" style="color:#' + d.name_color + ';">' + d.name + '</div>' +
                                            '<div class="g-info-type">' + d.type + '</div>' +
                                            '<div class="g-info-price"><span class="tip">市场参考价:</span><span class="number">' + $("#market_price").html() + '</span></div>' +
                                            '<div class="g-info-tags">标签:' + tagsHtml + '</div>' +
                                            '<div class="g-info-list">' + html + '</div>' +
                                            '</div>' +
                                            '</li>');

                                        var t = _that.siblings(".backpack-goods-modal");
                                        t.css("display", "block");
                                        var s = $("body").width()
                                            , e = t.width();
                                        s - _that.offset().left - _that.width() <= e + 50 ? t.addClass("left") : t.addClass("right");
                                    }
                                    _that.siblings('.backpack-goods-modal').css('display', 'block');
                                    goodsInfoPanel = true;
                                },
                                error: function () {

                                }
                            })
                        }

                    }

                }, 200);
            });
            //商品详情面板隐藏
            $('.d-goods-other-list').on('mouseout', '.goods-info-img', function () {
                clearTimeout(timer);
                $(this).siblings('.backpack-goods-modal').css('display', 'none');
            });
        })
    </script>
</block>
{include file="common@common/foot"}
</body>